<% layout("/layouts/boilerplate") %>

  <!-- Active Filter Display -->
  <% if (searchQuery || selectedCategory || selectedLocation || minPrice || maxPrice) { %>
    <div class="mb-1">
      <h6 class="text-muted fw-semibold">
        Showing results
        <% if (searchQuery) { %> for "<%= searchQuery %>" <% } %>
              <% if (selectedCategory) { %> in "<%= selectedCategory %>" <% } %>
                    <% if (selectedLocation) { %> near "<%= selectedLocation %>" <% } %>
                          <% if (minPrice || maxPrice) { %>
                            with price
                            <% if (minPrice) { %> ≥ ₹<%= minPrice %>
                                <% } %>
                                  <% if (minPrice && maxPrice) { %> and <% } %>
                                      <% if (maxPrice) { %> ≤ ₹<%= maxPrice %>
                                          <% } %>
                                            <% } %>
      </h6>

      <a href="/listings" class="btn btn-outline-secondary btn-sm mt-2">
        <i class="fa-solid fa-filter-circle-xmark me-1"></i> Clear Filters
      </a>
    </div>
    <% } %>

      <!-- Category Filter Icons -->
      <% const queryParams=new URLSearchParams(); %>
        <% if (searchQuery) queryParams.append("q", searchQuery); %>
          <% if (selectedLocation) queryParams.append("location", selectedLocation); %>
            <% if (minPrice) queryParams.append("minPrice", minPrice); %>
              <% if (maxPrice) queryParams.append("maxPrice", maxPrice); %>

                <div class="w-100 px-3 px-md-5 ">
                  <div id="filters" style="margin-top: 1.25rem;">
                    <% const filters=[ "Trending" , "Rooms" , "Cities" , "Mountain" , "Pools" , "Camping" , "Farms"
                      , "Arctic" , "Domes" , "Boats" , "Hills" , "Temples" ]; const icons={ Trending: "fa-fire" ,
                      Rooms: "fa-bed" , Cities: "fa-mountain-city" , Mountain: "fa-mountain" ,
                      Pools: "fa-person-swimming" , Camping: "fa-campground" , Farms: "fa-cow" , Arctic: "fa-snowflake"
                      , Domes: "fa-igloo" , Boats: "fa-ship" , Hills: "fa-hill-rockslide" , Temples: "fa-gopuram" }; %>

                      <% filters.forEach(category=> {
                        const tempParams = new URLSearchParams(queryParams.toString());
                        tempParams.set("category", category);
                        %>
                        <a href="/listings?<%= tempParams.toString() %>"
                          class="filter text-decoration-none <%= selectedCategory === category ? 'text-primary fw-bold' : '' %>">
                          <div><i class="fa-solid <%= icons[category] %>"></i></div>
                          <p>
                            <%= category %>
                          </p>
                        </a>
                        <% }) %>
                  </div>
                </div>

                <!--No Results-->
                <% if (allListings.length===0) { %>
                  <div class="alert alert-warning text-center mt-4">
                    <i class="fa-solid fa-triangle-exclamation me-2"></i>
                    No listings found.
                  </div>
                  <% } %>

                    <!--Listings -->
                    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4 mt-3">
                      <% allListings.forEach(listing=> { %>
                        <a href="/listings/<%= listing._id %>" class="listing-link col">
                          <div class="card listing-card h-100">
                            <img src="<%= listing.image.url %>" class="card-img-top"
                              alt="Image of <%= listing.title %>" />
                            <div class="card-body">
                              <p class="card-text mb-0">
                                <b>
                                  <%= listing.title %>
                                </b><br />
                                ₹<%= listing.price.toLocaleString("en-IN") %> / night
                              </p>
                            </div>
                          </div>
                        </a>
                        <% }) %>
                    </div>